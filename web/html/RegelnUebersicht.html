<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ComPeteHub</title>
    <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.css">
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../node_modules/axios/dist/axios.js"></script>
</head>

<body>
    <script src="../js/Navigation.js"></script> <!-- Navbar laden & einfügen -->

    <div class="container my-5">
        <div class="p-5 text-center bg-body-tertiary rounded-3">
            <h1 class="display-4">Regeln</h1>
            <p class="lead">Übersicht für die Regeln</p>
        </div><!-- /.jumbotron -->

        <div class="d-flex justify-content-center m-2">
            <a href="RegelnAktualisierung.html"><button class="btn" id="regelButton">Regeln aktualisieren</button></a>
        </div>

        <div class="row">
            <!-- Kategorie -->
            <div class="form-group col-md-6 col-sm-12 col-lg-6">
                <label for="category">Kategorie</label>
                <select id="category" class="form-select kategorien" required>
                </select>
            </div>

            <!-- Datum -->
            <div class="form-group col-md-6 col-lg-6 col-sm-12">
                <label for="date">Datum</label>
                <input type="date" class="form-control datum" id="date" min="2020-01-01" required>
            </div>
        </div>
        <div class="row">
            <!-- Übung -->
            <div class="form-group col-md-6 col-sm-12 col-lg-6">
                <label for="exercise">Übung</label>
                <select id="exercise" class="form-select uebungen" required>
                </select>
            </div>
        </div>

        <br>

        <div class="d-flex justify-content-center m-2">
            <h5><strong>Männlich und Divers</strong></h5>
        </div>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">6-7</th>
                    <th scope="col">8-9</th>
                    <th scope="col">10-11</th>
                    <th scope="col">12-13</th>
                    <th scope="col">14-15</th>
                    <th scope="col">16-17</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td scope="col">Bronze</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td scope="col">Silber</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td scope="col">Gold</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>

        <br>

        <div class="d-flex justify-content-center m-2">
            <h5><strong>Weiblich</strong></h5>
        </div>

        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">6-7</th>
                    <th scope="col">8-9</th>
                    <th scope="col">10-11</th>
                    <th scope="col">12-13</th>
                    <th scope="col">14-15</th>
                    <th scope="col">16-17</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td scope="col">Bronze</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td scope="col">Silber</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td scope="col">Gold</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div><!-- /.container -->

    <!-- Modal für Erfolg & bereits erstellte Sportler-->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header d-flex-row justify-content-center text-center">
                    <h1 class="modal-title fs-5 display-4 " id="exampleModalLabel"><strong>Sportler erfolgreich
                            erstellt!</strong></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light border border-2 ms-3"
                        onclick="window.location.href = '../index.html';">Verstanden</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        try {
            const response = await axios.post('http://localhost:8080/v1/user/start-session', {},
                { withCredentials: true });
            // Wenn die Anfrage erfolgreich ist (200 OK), mache weiter
        } catch (error) {
            if (error.response) {
                // Bei Fehler mit Response gehe zu Anmeldung.html
                window.location.href = "Anmeldung.html";
            } else {
                //Falls Server nicht erreichbar ist
                if (error.code == "ERR_NETWORK") {
                    console.log("Backend nicht erreichbar:" + error)
                    window.location.href = "BackendDown.html";
                } else {
                    // Andere Fehler
                    console.log("Fehler: " + error)
                }
            }
        }

        document.getElementById("date").value = new Date().getFullYear() + "-01-01";

        const today = new Date();
        const redOrNot = today >= new Date(today.getFullYear(), 0, 1) && today < new Date(today.getFullYear(), 0, 1, 7 * 4);
        if (redOrNot) {
            document.getElementById("regelButton").className = "btn btn-danger border border-2 ms-3";
        } else {
            document.getElementById("regelButton").className = "btn btn-light border border-2 ms-3";
        }

        // GET Kategorien und Dropdowns auffüllen
        try {
            // Kategorie-Daten vom Backend abrufen
            const categoryResponse = await axios.get('http://localhost:8080/v1/discipline/get-all', { withCredentials: true });
            const disciplines = categoryResponse.data.discipline_names;

            // Kategorien Dropdown befüllen
            const kategorien = document.querySelector('.kategorien');
            kategorien.innerHTML = "";
            disciplines.forEach(element => {
                kategorien.innerHTML += `<option value="${element}">${element}</option>`;
            });

            // Übungen für die erste Kategorie direkt laden
            if (disciplines.length > 0) {
                await loadExercises(disciplines[0]);
            }
        } catch (error) {
            console.error("Fehler beim Laden der Kategorien:", error);
            alert("Kategorien konnten nicht geladen werden.");
        }

        // Event Listener für Kategorieänderung
        document.querySelector(".kategorien").addEventListener("change", async (event) => {
            //const category = document.getElementById("category").value;
            await loadExercises(event.target.value);
        });

        // Event Listener für Datumsänderung
        document.querySelector(".datum").addEventListener("change", async (event) => {
            const value = document.getElementById("date").value;
            document.getElementById("date").value = value[0]+value[1]+value[2]+value[3] + "-01-01";
        });
    });

    async function loadExercises(category) {
      try {
        const athleteId = new URLSearchParams(window.location.search).get("id");
        const datum = document.getElementById("date").value;
        const exerciseResponse = await axios.get(`http://localhost:8080/v1/exercise/get/${category}?athlete-id=${athleteId}&performance-date=${datum}`, { withCredentials: true });
        exercisesList = exerciseResponse.data.exercises;  // Übungen speichern
        // Übungen Dropdown befüllen
        const uebungen = document.querySelector('.uebungen');
        uebungen.innerHTML = "";  // Vorherige Optionen löschen
        exercisesList.forEach(element => {
          uebungen.innerHTML += `<option value="${element.exercise_id}">${element.name}</option>`;
        });
        // Überprüfen, ob eine Übung direkt ausgewählt werden kann
        if (exercisesList.length > 0) {
          updateFieldByUnit(exercisesList[0].exercise_id);
        }
      } catch (error) {
        console.error("Fehler beim Laden der Übungen:", error);
        alert("Übungen konnten nicht geladen werden.");
      }
    }

    // Dynamisch das Eingabefeld nach der Einheit rendern
    function updateFieldByUnit(exerciseId) {
      
    }
</script>