<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ComPeteHub</title>
    <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.css">
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../node_modules/axios/dist/axios.js"></script>
  </head>
  <body>
    <!-- DOCUMENTATION NAVBAR-->
    <nav class="navbar sticky-top navbar-expand-lg" style="background-color: #292c33;">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html" style="color: white">ComPeteHub</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Alles was collapsed werden soll, wenn der Bildschirm kleiner wird-->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          
          <!-- Alles was links in die navabr soll-->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          </ul>

           <!-- Alles was rechts in die navabr soll-->
           <div class="flex-d">
           </div>
      </div>
    </nav>

    <!--Überschrift + Beschreibung-->
    <div class="Überschrift">
      <div class="container mt-5">
        <div class="p-1 text-center bg-body-tertiary rounded-3">
          <h1 class="display-4">Leistungsübersicht</h1>
          <p class="lead"> Hier können aktuelle und vergangene Leistungen des ausgewählten Sportlers angesehen werden. 
            <br> Für weitere Informationen auf die einzelnen Kategorien klicken!</p>          
        </div>
    </div>

    <!--Sportlerinfos Name, etc.-->
    <div class="Sportlerinfos">
      <div class="container my-5">
        <div class="text-center bg-body-tertiary rounded-3">

          <h1 class="display-4" id="sportlerinfos-name"> <b> Vorname Nachname </b>  </h1>
          <p class="lead" id="sportlerinfos-alter-ges"> 99.99.9999 - 99 Jahre - Geschlecht </p>
          
          <!--TODO-->
          <div class="optionen">
            <div class="d-flex justify-content-center align-items-center gap-3">
              <a href="test.html" style="text-decoration: none;">
                <button class="btn btn-light border border-2 my-1" id="button-eintragen" style="font-weight: bold;">Leistungen eintragen</button>
              </a>
              <a href="test2.html" style="text-decoration: none;">
                <button class="btn btn-light border border-2 my-1" id="button-bearbeiten" style="font-weight: bold;">Leistungen bearbeiten</button>
              </a>
            </div>            
          </div>

        </div>        
      </div>      
    </div>

    
    



    <!------------------------------------->
    <!--Kategorien + Aufklappbare Details-->
    <!------------------------------------->

    <div class="my-5">
      <!--Kategorie 1 Ausdauer-->
      <div class="container my-1">
        <div class="p-2 text-center bg-body-tertiary rounded-3">        
            <div id="ausdauer-kopfzeile-gesamt" class="d-flex mx-5 justify-content-between align-items-center " onclick="toggleDetails('ausdauer-tabelle')"> 
              <div id="ausdauer-kopfzeile-lW" class="flex-shrink-0 text-center"> 
                <h6 class="lead">letzter Wert</h4>
                <p class="wert" style="font-size: 30px;"></p>
              </div>            
                <h2 class="display-4 position-absolute start-50 translate-middle-x">Ausdauer</h2>  
              <div id="ausdauer-kopfzeile-m" class="flex-shrink-0">  
                <h6 class="lead">Medaille</h4>
                <p class="wert" style="font-size: 30px;"></p>     
              </div>
            </div>
            <table class="table d-none" id="ausdauer-tabelle" >
              <tr>
                <th>Disziplin</th>
                <th>Datum</th>
                <th>Wert</th>
                <th>Medaille</th>   
              </tr>                 
              <!-- wird mit passenden Einträgen befüllt-->
            </table>
        </div>
      </div>

      <!--Kategorie 2 schnelligkeit-->
      <div class="container my-1">
        <div class="p-2 text-center bg-body-tertiary rounded-3">        
            <div id="schnelligkeit-kopfzeile-gesamt" class="d-flex mx-5 justify-content-between align-items-center " onclick="toggleDetails('schnelligkeit-tabelle')"> 
              <div id="schnelligkeit-kopfzeile-lW" class="flex-shrink-0 text-center"> 
                <h6 class="lead">letzter Wert</h4>
                <p class="wert" style="font-size: 30px;"></p>
              </div>            
              <h2 class="display-4 position-absolute start-50 translate-middle-x">Schnelligkeit</h2>  
              <div id="schnelligkeit-kopfzeile-m" class="flex-shrink-0">  
                <h6 class="lead">Medaille</h4>
                <p class="wert" style="font-size: 30px;"></p>     
              </div>
            </div>
            <table class="table d-none" id="schnelligkeit-tabelle" >
              <tr>
                <th>Disziplin</th>
                <th>Datum</th>
                <th>Wert</th>
                <th>Medaille</th>   
              </tr>                 
              <!-- wird mit passenden Einträgen befüllt-->
            </table>
        </div>
      </div>


      <!--Kategorie 3 kraft-->
      <div class="container my-1">
        <div class="p-2 text-center bg-body-tertiary rounded-3">        
            <div id="kraft-kopfzeile-gesamt" class="d-flex mx-5 justify-content-between align-items-center " onclick="toggleDetails('kraft-tabelle')"> 
              <div id="kraft-kopfzeile-lW" class="flex-shrink-0 text-center"> 
                <h6 class="lead">letzter Wert</h4>
                <p class="wert" style="font-size: 30px;"></p>
              </div>            
              <h2 class="display-4 position-absolute start-50 translate-middle-x">Kraft</h2>  
              <div id="kraft-kopfzeile-m" class="flex-shrink-0">  
                <h6 class="lead">Medaille</h4>
                <p class="wert" style="font-size: 30px;"></p>     
              </div>
            </div>
            <table class="table d-none" id="kraft-tabelle" >
              <tr>
                <th>Disziplin</th>
                <th>Datum</th>
                <th>Wert</th>
                <th>Medaille</th>   
              </tr>                 
              <!-- wird mit passenden Einträgen befüllt-->
            </table>
        </div>
      </div>

      <!--Kategorie 4 koordination-->
      <div class="container my-1">
        <div class="p-2 text-center bg-body-tertiary rounded-3">        
            <div id="koordination-kopfzeile-gesamt" class="d-flex mx-5 justify-content-between align-items-center " onclick="toggleDetails('koordination-tabelle')"> 
              <div id="koordination-kopfzeile-lW" class="flex-shrink-0 text-center"> 
                <h6 class="lead">letzter Wert</h4>
                <p class="wert" style="font-size: 30px;"></p>
              </div>            
              <h2 class="display-4 position-absolute start-50 translate-middle-x">Koordination</h2>  
              <div id="koordination-kopfzeile-m" class="flex-shrink-0">  
                <h6 class="lead">Medaille</h4>
                <p class="wert" style="font-size: 30px;"></p>     
              </div>
            </div>
            <table class="table d-none" id="koordination-tabelle" >
              <tr>
                <th>Disziplin</th>
                <th>Datum</th>
                <th>Wert</th>
                <th>Medaille</th>   
              </tr>                 
              <!-- wird mit passenden Einträgen befüllt-->
            </table>
        </div>
      </div>

    <script>
      //TODO

      let exercisesList = [];  // Liste der Übungen
      let points = null;       // Punktewert zur Übergabe ans Backend

      // Lade alles notwendige vor
      document.addEventListener("DOMContentLoaded", async () => {
        // Überprüfung, ob User angemeldet ist
        try{
          const response = await axios.post('http://localhost:8080/v1/user/start-session', {}, 
          {withCredentials: true});
          // Wenn die Anfrage erfolgreich ist (200 OK), mache weiter
        } catch(error) {
          if (error.response) {
            // Bei Fehler mit Response gehe zu Anmeldung.html
            window.location.href = "Anmeldung.html";
          } else {
            // Andere Fehler
            alert(error.message);
            window.location.href = "Anmeldung.html";
          }
        }
      

        try {
          // Daten vom Backend abrufen & vorbereiten
          const athleteId = new URLSearchParams(window.location.search).get("id");
          const response = await axios.get(`http://localhost:8080/v1/athlete/get/${athleteId}`, {
            withCredentials: true,
          });
          const athlete = response.data.athlete;
          var sex = "";
          if (athlete.sex === "m") {
            sex = 'Männlich';
          } else if (athlete.sex === "f") {
            sex = 'Weiblich';
          } else if (athlete.sex === "d") {
            sex = 'Divers';
          }

          //Alter berechnen
          const currentDate = new Date().toJSON().slice(0, 10)          
          var age = currentDate.split('-')[0]-athlete.birth_date.split('T')[0].split('-')[0];
          if((currentDate.split('-')[1]<athlete.birth_date.split('T')[0].split('-')[1]) || (currentDate.split('-')[2]===athlete.birth_date.split('T')[0].split('-')[2])){
            age--;
          }
          const birthdate = athlete.birth_date.split("T")[0].split('-')[2] + '.' + athlete.birth_date.split("T")[0].split('-')[1] + '.' + athlete.birth_date.split("T")[0].split('-')[0];
        
          //Sportlerinfos (Name, Alter, etc.) befüllen
          const sportlerInfoDaten = {"vorname": athlete.first_name, "nachname": athlete.last_name, "geburtstag": birthdate, "alter": age, "geschlecht": sex};
          sportlerInfosFüllen(sportlerInfoDaten);
        }
        catch (error) {
          console.error("Fehler beim Laden der Daten:", error);
          alert("Athlet konnte nicht geladen werden.");
        }
        
        //Letzte Performanceeinträge in Kategorienkopfzeilen eintragen
        try{
        const athleteId = new URLSearchParams(window.location.search).get("id");
        const response =  await axios.get(`/v1/performance/get-latest/{AthleteId}${athleteId}`);

        console.log(response)
        }
        catch (error){
          
          console.error("Fehler beim Laden der Daten:", error);
            alert("Einträge des Athleten konnten nicht geladen werden.");
        }
      
      })

      

      

      //Kopfzeile pro Kategorie füllen...
      const testKopfDaten = {"wert": "123879m", "medaille":"🥉"};
      const testKopfDaten2 = {"wert": "12s", "medaille":"🥉"};      
      const testKopfDaten3 = {"wert": "1232412134123s", "medaille":"🥉"};

      kategorieKopfzeileFüllen("ausdauer-kopfzeile-gesamt", testKopfDaten);
      kategorieKopfzeileFüllen("schnelligkeit-kopfzeile-gesamt", testKopfDaten2);      
      kategorieKopfzeileFüllen("kraft-kopfzeile-gesamt", testKopfDaten3);
      kategorieKopfzeileFüllen("koordination-kopfzeile-gesamt", testKopfDaten);
      
      //Tabellen befüllen testen 
      const testDaten = [ {"disziplin": "300m Sprint", "datum": "30.01.2025", "wert": "30,89s", "medaille": "gold"},
                          {"disziplin": "100m Sprint", "datum": "19.01.2025", "wert": "45,89s", "medaille": "bronze"}];
      
      tabelleFüllen("ausdauer-tabelle", testDaten);
      tabelleFüllen("schnelligkeit-tabelle", testDaten);   
      tabelleFüllen("kraft-tabelle", testDaten);
      tabelleFüllen("koordination-tabelle", testDaten);     
      
      //TODO
      

      function sportlerInfosFüllen(daten){
        const divName = document.getElementById("sportlerinfos-name");
        const divAlterGes = document.getElementById("sportlerinfos-alter-ges");    

        divName.innerHTML = `<b> ${daten["vorname"]} ${daten["nachname"]} </b>`;
        divAlterGes.innerHTML = `<p> ${daten["geburtstag"]} - ${daten["alter"]} Jahre - ${daten["geschlecht"]}</p>`

      }
      
      //Für die Kategorien die letzten Werte + Medaille befüllen
      function kategorieKopfzeileFüllen(id, daten){
        const div = document.getElementById(id)

        const pWerte = div.getElementsByClassName("wert")
        pWerte[0].innerHTML = daten["wert"]
        pWerte[1].innerHTML = daten["medaille"]
      }

      //Tabellen mit Infos anzeigen/verbergen
      function toggleDetails(id) {
            let details = document.getElementById(id); 
            details.classList.toggle("d-none");
        }
      

      //Fügt den jeweiligen Kategorie-Tabellen die Daten hinzu.
      function tabelleFüllen(id, daten){
        const table = document.getElementById(id);

        for (let i =0; i<daten.length; i++){ //alle Daten durchgehen 
          //in Zellen packen, die in eine Zeile und die dann am Ende in Tabelle
          let row = table.insertRow(-1);
          let cell1 = row.insertCell(0);
          let cell2 = row.insertCell(1);
          let cell3 = row.insertCell(2);
          let cell4 = row.insertCell(3);

          cell1.innerHTML = daten[i]["disziplin"];
          cell2.innerHTML = daten[i]["datum"];
          cell3.innerHTML = daten[i]["wert"];
          cell4.innerHTML = daten[i]["medaille"];
          
        }
      }
      
      
    </script>
  </body>
</html>